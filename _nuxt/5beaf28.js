(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{292:function(e,t,n){"use strict";n.r(t);n(15),n(16),n(10),n(37),n(85),n(61),n(31);var r=n(8),c=n(13),o=n(53),l=n(19),d=n(20),v=n(9),_=n(7),h=n(33);function f(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(v.a)(e);if(t){var c=Object(v.a)(this).constructor;n=Reflect.construct(r,arguments,c)}else n=r.apply(this,arguments);return Object(d.a)(this,n)}}var y=function(e,t,n,desc){var r,c=arguments.length,o=c<3?t:null===desc?desc=Object.getOwnPropertyDescriptor(t,n):desc;if("object"===("undefined"==typeof Reflect?"undefined":Object(_.a)(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,desc);else for(var i=e.length-1;i>=0;i--)(r=e[i])&&(o=(c<3?r(o):c>3?r(t,n,o):r(t,n))||o);return c>3&&o&&Object.defineProperty(t,n,o),o},m=function(e){Object(l.a)(k,e);var t,n,d,v,_,h,y,m=f(k);function k(){var e;return Object(c.a)(this,k),(e=m.apply(this,arguments)).loading=!1,e.loadingPlans=!1,e.loadingSave=!1,e.loadingDelete=!1,e.subscriptions={data:[]},e.plans={data:[]},e.selectedPlan="",e.currencies={usd:"$",eur:"€",inr:"₹"},e}return Object(o.a)(k,[{key:"mounted",value:(y=Object(r.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.getPlans(),e.abrupt("return",this.get());case 2:case"end":return e.stop()}}),e,this)}))),function(){return y.apply(this,arguments)})},{key:"get",value:(h=Object(r.a)(regeneratorRuntime.mark((function e(){var t,n,r,data;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.loading=!0,e.prev=1,e.next=4,this.$axios.get("/groups/".concat(this.$route.params.id,"/subscriptions"));case 4:r=e.sent,data=r.data,this.subscriptions=data,e.next=13;break;case 9:if(e.prev=9,e.t0=e.catch(1),"no-customer"!==(null===(n=null===(t=e.t0.response)||void 0===t?void 0:t.data)||void 0===n?void 0:n.error)){e.next=13;break}return e.abrupt("return",this.$router.replace("/teams/".concat(this.$route.params.id,"/billing?no-billing-account")));case 13:this.loading=!1;case 14:case"end":return e.stop()}}),e,this,[[1,9]])}))),function(){return h.apply(this,arguments)})},{key:"getPlans",value:(_=Object(r.a)(regeneratorRuntime.mark((function e(){var t,data;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.loadingPlans=!0,e.prev=1,e.next=4,this.$axios.get("/groups/".concat(this.$route.params.id,"/billing/pricing"));case 4:t=e.sent,data=t.data,this.plans=data,this.plans.data.length&&(this.selectedPlan=this.plans.data[0].id),e.next=12;break;case 10:e.prev=10,e.t0=e.catch(1);case 12:this.loadingPlans=!1;case 13:case"end":return e.stop()}}),e,this,[[1,10]])}))),function(){return _.apply(this,arguments)})},{key:"save",value:(v=Object(r.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.loadingSave=!0,e.prev=1,e.next=4,this.$axios.put("/groups/".concat(this.$route.params.id,"/subscriptions"),{plan:this.selectedPlan});case 4:e.sent.data,this.get(),e.next=11;break;case 9:e.prev=9,e.t0=e.catch(1);case 11:this.loadingSave=!1;case 12:case"end":return e.stop()}}),e,this,[[1,9]])}))),function(){return v.apply(this,arguments)})},{key:"update",value:(d=Object(r.a)(regeneratorRuntime.mark((function e(t,n){var c=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.$buefy.dialog.confirm({title:"Changing your subscription",message:"Are you sure you want to change your subscription?",confirmText:"Yes, change subscription",cancelText:"No, don't change",type:"is-warning",hasIcon:!0,trapFocus:!0,onConfirm:function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c.loadingSave=!0,e.prev=1,e.next=4,c.$axios.patch("/groups/".concat(c.$route.params.id,"/subscriptions/").concat(t),{cancel_at_period_end:!1,proration_behavior:"create_prorations",items:[{id:n,plan:c.selectedPlan}]});case 4:e.sent.data,c.get(),e.next=11;break;case 9:e.prev=9,e.t0=e.catch(1);case 11:c.loadingSave=!1;case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(){return e.apply(this,arguments)}}()});case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return d.apply(this,arguments)})},{key:"keep",value:(n=Object(r.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.loadingDelete=!0,e.prev=1,e.next=4,this.$axios.patch("/groups/".concat(this.$route.params.id,"/subscriptions/").concat(t),{cancel_at_period_end:!1});case 4:e.sent.data,this.get(),e.next=11;break;case 9:e.prev=9,e.t0=e.catch(1);case 11:this.loadingDelete=!1;case 12:case"end":return e.stop()}}),e,this,[[1,9]])}))),function(e){return n.apply(this,arguments)})},{key:"cancel",value:(t=Object(r.a)(regeneratorRuntime.mark((function e(t){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.$buefy.dialog.confirm({title:"Canceling your subscription",message:"Are you sure you want to cancel your subscription? You'll still be able to use it until the end of this billing period.",confirmText:"Yes, cancel subscription",cancelText:"No, don't cancel",type:"is-danger",hasIcon:!0,trapFocus:!0,onConfirm:function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.loadingDelete=!0,e.prev=1,e.next=4,n.$axios.patch("/groups/".concat(n.$route.params.id,"/subscriptions/").concat(t),{cancel_at_period_end:!0});case 4:e.sent.data,n.get(),e.next=11;break;case 9:e.prev=9,e.t0=e.catch(1);case 11:n.loadingDelete=!1;case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(){return e.apply(this,arguments)}}()});case 1:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"availablePlans",value:function(e){var t=this.plans.data.filter((function(i){return i.id!==e}));return t.length&&(this.selectedPlan=t[0].id),t}},{key:"getColor",value:function(e){switch(e){case"active":return"is-success";case"trialing":return"is-warning";case"past_due":case"canceled":case"unpaid":return"is-danger";default:return"is-light"}}},{key:"hasFreeTrial",get:function(){var e,t=this;return!!(null===(e=this.plans.data.find((function(i){return i.id===t.selectedPlan})))||void 0===e?void 0:e.trial_period_days)}}]),k}(h.b),k=m=y([Object(h.a)({middleware:"authenticated",layout:"teams"})],m),w=n(11),component=Object(w.a)(k,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",[n("h1",{staticClass:"is-size-4 mb-4"},[e._v("Subscription")]),e._v(" "),e._l(e.subscriptions.data,(function(t){return n("div",{key:"s"+t.id},[t.default_source?e._e():n("b-message",{attrs:{type:"is-warning","has-icon":""}},[e._v("\n        You don't have a payment method attached to this subscription. If\n        we're unable to charge you, your subscription may be canceled.\n        "),n("nuxt-link",{attrs:{to:"/teams/"+e.$route.params.id+"/billing/sources"}},[e._v("Add payment method")])],1),e._v(" "),n("h2",{staticClass:"is-size-5 mb-3"},[n("span",[e._v(e._s(t.plan.nickname))]),e._v(" "),n("b-tag",{attrs:{type:e.getColor(t.status)}},[e._v("\n          "+e._s("trialing"===t.status?"Trial":t.status)+"\n        ")]),e._v(" "),t.cancel_at_period_end?n("b-tag",{attrs:{type:"is-danger"}},[e._v("Scheduled for cancelation")]):e._e()],1),e._v(" "),n("table",{staticClass:"table"},[n("tbody",[n("tr",[n("td",[e._v("Started")]),e._v(" "),n("td",[e._v("\n              "+e._s(new Date(1e3*t.start_date).toLocaleDateString())+"\n            ")])]),e._v(" "),n("tr",[n("td",[e._v("Price")]),e._v(" "),n("td",[n("span",[e._v("\n                "+e._s(e.currencies[t.plan.currency]||t.plan.currency)+e._s(t.plan.amount/100)+"\n              ")]),e._v(" "),1!==t.plan.interval_count?n("span",[e._v("\n                every "+e._s(t.plan.interval_count)+"\n                "+e._s(t.plan.interval)+"s\n              ")]):n("span",[e._v("/"+e._s(t.plan.interval))])])]),e._v(" "),"trialing"===t.status?n("tr",[n("td",[e._v("Trial ends")]),e._v(" "),n("td",[e._v("\n              "+e._s(new Date(1e3*t.trial_end).toLocaleDateString())+"\n            ")])]):e._e(),e._v(" "),t.cancel_at?n("tr",[n("td",[e._v("Cancels")]),e._v(" "),n("td",[e._v("\n              "+e._s(new Date(1e3*t.cancel_at).toLocaleDateString())+"\n            ")])]):n("tr",[n("td",[e._v("Current period ends")]),e._v(" "),n("td",[e._v("\n              "+e._s(new Date(1e3*t.current_period_end).toLocaleDateString())+"\n            ")])])])]),e._v(" "),e.availablePlans(t.plan.id).length?n("form",{on:{submit:function(n){return n.preventDefault(),e.update(t.id,t.items.data[0].id)}}},[n("h2",{staticClass:"is-size-5 mb-3"},[e._v("Change subscription")]),e._v(" "),e._l(e.availablePlans(t.plan.id),(function(t){return n("div",{key:"p"+t.id,staticClass:"field"},[n("b-radio",{attrs:{"native-value":t.id},model:{value:e.selectedPlan,callback:function(t){e.selectedPlan=t},expression:"selectedPlan"}},[n("span",[e._v(e._s(t.nickname))]),e._v("\n            (\n            "),n("span",[n("span",[e._v("\n                "+e._s(e.currencies[t.currency]||t.currency)+e._s(t.amount/100)+"\n              ")]),e._v(" "),1!==t.interval_count?n("span",[e._v("every "+e._s(t.interval_count))]):n("span",[e._v("/"+e._s((t.interval||"").charAt(0)))])]),e._v(")\n          ")])],1)})),e._v(" "),n("b-button",{attrs:{"native-type":"submit","icon-left":"pencil",loading:e.loadingSave}},[e._v("Change plan")])],2):e._e(),e._v(" "),"canceled"===t.status||t.cancel_at_period_end?n("div",[n("h2",{staticClass:"is-size-5 mb-3"},[e._v("Continue subscription")]),e._v(" "),n("p",[e._v("\n          Your subscription has been canceled. If you've changed your mind,\n          you can continue your subscription.\n        ")]),e._v(" "),n("b-button",{attrs:{type:"is-success",loading:e.loadingDelete,"icon-left":"check"},on:{click:function(n){return e.keep(t.id)}}},[e._v("Keep subscription")])],1):n("div",[n("h2",{staticClass:"is-size-5 mb-3 mt-5"},[e._v("Danger zone")]),e._v(" "),n("p",[e._v("\n          After you've canceled your subscription, you can continue to use it\n          until the end of this billing cycle, but we won't charge you again.\n        ")]),e._v(" "),n("b-button",{attrs:{type:"is-danger",loading:e.loadingDelete,"icon-left":"cancel"},on:{click:function(n){return e.cancel(t.id)}}},[e._v("Cancel subscription")])],1)],1)})),e._v(" "),n("b-loading",{attrs:{"is-full-page":!1,active:e.loading},on:{"update:active":function(t){e.loading=t}}})],2),e._v(" "),e.plans.data.length&&!e.subscriptions.data.length?n("form",{on:{submit:function(t){return t.preventDefault(),e.save(t)}}},[n("h2",{staticClass:"is-size-5 mb-3"},[e._v("Change your plan")]),e._v(" "),e._l(e.plans.data,(function(t){return n("div",{key:"p"+t.id,staticClass:"field"},[n("b-radio",{attrs:{"native-value":t.id},model:{value:e.selectedPlan,callback:function(t){e.selectedPlan=t},expression:"selectedPlan"}},[n("span",[e._v(e._s(t.nickname))]),e._v("\n        (\n        "),n("span",[n("span",[e._v("\n            "+e._s(e.currencies[t.currency]||t.currency)+e._s(t.amount/100)+"\n          ")]),e._v(" "),1!==t.interval_count?n("span",[e._v("every "+e._s(t.interval_count))]):n("span",[e._v("/"+e._s((t.interval||"").charAt(0)))])]),e._v(")\n        "),t.trial_period_days?n("span",{staticClass:"has-text-grey"},[e._v(e._s(t.trial_period_days)+" days free trial")]):e._e()])],1)})),e._v(" "),n("b-button",{attrs:{type:"is-primary","native-type":"submit",loading:e.loadingSave}},[e.hasFreeTrial?n("span",[e._v("Start free trial")]):n("span",[e._v("Start subscription")])]),e._v(" "),n("b-loading",{attrs:{"is-full-page":!1,active:e.loadingPlans},on:{"update:active":function(t){e.loadingPlans=t}}})],2):e._e()])}),[],!1,null,null,null);t.default=component.exports}}]);